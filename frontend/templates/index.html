<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML Learning - Handwriting Recognition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: {
                            900: '#121212',
                            800: '#1e1e1e',
                            700: '#2d2d2d',
                            600: '#383838',
                            500: '#404040',
                            400: '#555555',
                            300: '#6e6e6e',
                            200: '#aaaaaa',
                            100: '#d4d4d4',
                        },
                        accent: {
                            blue: '#3b82f6',
                            purple: '#8b5cf6',
                            green: '#10b981',
                            yellow: '#f59e0b',
                            red: '#ef4444',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'pulse-slow': 'pulse 3s infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        glow: {
                            '0%': { textShadow: '0 0 5px #3b82f6, 0 0 10px #3b82f6' },
                            '100%': { textShadow: '0 0 10px #3b82f6, 0 0 20px #3b82f6' },
                        },
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-dark-900 text-gray-100 font-sans">
    <div class="container mx-auto max-w-6xl px-3 py-4 animate-fade-in">
        <!-- Main Content -->
        <div class="grid grid-cols-12 gap-4">
            <!-- Left Column (5/12) -->
            <div class="col-span-12 md:col-span-5 space-y-4 animate-slide-up">
                <!-- App Title -->
                <div class="mb-2">
                    <h1 class="text-2xl font-bold text-white">
                        <span class="text-accent-blue">ML</span> Handwriting Recognition
                    </h1>
                    <p class="text-dark-200 text-sm">Convert handwritten text to digital text using machine learning</p>
                </div>
                
                <!-- Model Status -->
                <div class="bg-dark-800 border-l-4 border-accent-blue p-3 rounded-md flex items-start">
                    <i class="fas fa-info-circle text-accent-blue text-lg mr-3 mt-0.5"></i>
                    <div>
                        {% if model_loaded %}
                            <strong>Model Status:</strong> Loaded and ready to use
                        {% else %}
                            <strong>Model Status:</strong> Not loaded. Please train the model first.
                        {% endif %}
                    </div>
                </div>
                
                <!-- Train Model Button -->
                <button id="trainButton" class="w-full bg-accent-blue hover:bg-blue-600 text-white py-2.5 px-4 rounded-md transition-all duration-300 transform hover:scale-[1.02] flex items-center justify-center">
                    <i class="fas fa-brain mr-2"></i>Train Model
                </button>
                
                <!-- Tabs -->
                <div class="bg-dark-800 rounded-md overflow-hidden">
                    <div class="flex border-b border-dark-600">
                        <button id="camera-tab" class="flex-1 py-2.5 px-4 bg-dark-700 text-accent-blue font-medium border-b-2 border-accent-blue flex items-center justify-center">
                            <i class="fas fa-camera mr-2"></i>Camera
                        </button>
                        <button id="upload-tab" class="flex-1 py-2.5 px-4 bg-dark-800 text-dark-200 hover:bg-dark-700 transition-colors flex items-center justify-center">
                            <i class="fas fa-upload mr-2"></i>Upload
                        </button>
                    </div>
                    
                    <!-- Tab Content -->
                    <div class="p-3">
                        <!-- Camera Tab (Default Active) -->
                        <div id="camera-content" class="space-y-3">
                            <div class="rounded-md overflow-hidden bg-dark-700">
                                <video id="video" class="w-full" autoplay playsinline></video>
                                <canvas id="canvas" class="hidden"></canvas>
                            </div>
                            <div class="flex space-x-2">
                                <button id="captureButton" class="flex-1 bg-accent-blue hover:bg-blue-600 text-white py-2 px-3 rounded-md transition-all duration-300 flex items-center justify-center">
                                    <i class="fas fa-camera mr-2"></i>Capture
                                </button>
                                <button id="processButton" disabled class="flex-1 bg-accent-green hover:bg-green-600 text-white py-2 px-3 rounded-md transition-all duration-300 opacity-50 flex items-center justify-center">
                                    <i class="fas fa-cogs mr-2"></i>Process
                                </button>
                            </div>
                        </div>
                        
                        <!-- Upload Tab (Initially Hidden) -->
                        <div id="upload-content" class="hidden space-y-3">
                            <form id="uploadForm">
                                <div id="dropArea" class="border-2 border-dashed border-dark-500 rounded-md p-5 text-center cursor-pointer hover:border-accent-blue hover:bg-dark-700 transition-colors">
                                    <i class="fas fa-file-image text-3xl text-dark-300 mb-2"></i>
                                    <h5 class="text-base font-medium text-gray-200">Drag & Drop or Click to Upload</h5>
                                    <p class="text-dark-200 text-sm">Upload an image of handwritten text</p>
                                    <input class="hidden" type="file" id="imageUpload" accept="image/*">
                                </div>
                                <button type="submit" class="w-full mt-3 bg-accent-blue hover:bg-blue-600 text-white py-2 px-3 rounded-md transition-all duration-300 flex items-center justify-center">
                                    <i class="fas fa-upload mr-2"></i>Upload & Process
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column (7/12) -->
            <div class="col-span-12 md:col-span-7 space-y-4 animate-slide-up" style="animation-delay: 0.1s;">
                <!-- Results -->
                <div class="bg-dark-800 rounded-md overflow-hidden">
                    <div class="bg-dark-700 p-3 border-b border-dark-600 flex items-center">
                        <i class="fas fa-spell-check text-accent-blue mr-2"></i>
                        <h3 class="text-base font-medium">Recognized Text</h3>
                    </div>
                    <div id="resultText" class="p-4 min-h-[120px] bg-dark-800">
                        <p class="text-dark-200">Recognized text will appear here...</p>
                    </div>
                </div>
                
                <!-- ML Explanation -->
                <div class="bg-dark-800 rounded-md p-4 border-l-4 border-accent-yellow">
                    <h4 class="flex items-center text-base font-medium mb-2">
                        <i class="fas fa-lightbulb text-accent-yellow mr-2 animate-pulse-slow"></i>
                        How It Works
                    </h4>
                    <p class="text-dark-100 text-sm mb-2">This application uses a Convolutional Neural Network (CNN) trained on handwritten characters:</p>
                    <ol class="list-decimal list-inside space-y-0.5 text-dark-100 text-sm">
                        <li>The image is preprocessed to isolate characters</li>
                        <li>Each character is resized to 28Ã—28 pixels</li>
                        <li>The neural network predicts each character</li>
                        <li>Predictions are combined into text</li>
                    </ol>
                </div>
                
                <!-- Loading Indicator (Hidden by Default) -->
                <div id="loading" class="hidden flex flex-col items-center justify-center p-3 bg-dark-800 rounded-md">
                    <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-accent-blue mb-2"></div>
                    <p id="loadingText" class="text-dark-100 text-sm">Processing...</p>
                </div>
                
                <!-- Alerts (Hidden by Default) -->
                <div id="successAlert" class="hidden bg-dark-800 border-l-4 border-accent-green text-green-400 p-3 rounded-md text-sm"></div>
                <div id="errorAlert" class="hidden bg-dark-800 border-l-4 border-accent-red text-red-400 p-3 rounded-md text-sm"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const captureButton = document.getElementById('captureButton');
            const processButton = document.getElementById('processButton');
            const uploadForm = document.getElementById('uploadForm');
            const trainButton = document.getElementById('trainButton');
            const loading = document.getElementById('loading');
            const loadingText = document.getElementById('loadingText');
            const successAlert = document.getElementById('successAlert');
            const errorAlert = document.getElementById('errorAlert');
            const resultText = document.getElementById('resultText');
            const dropArea = document.getElementById('dropArea');
            const imageUpload = document.getElementById('imageUpload');
            
            // Tab elements
            const cameraTab = document.getElementById('camera-tab');
            const uploadTab = document.getElementById('upload-tab');
            const cameraContent = document.getElementById('camera-content');
            const uploadContent = document.getElementById('upload-content');
            
            // Tab switching
            cameraTab.addEventListener('click', function() {
                // Update tab styles
                cameraTab.classList.add('bg-dark-700', 'text-accent-blue', 'border-b-2', 'border-accent-blue');
                cameraTab.classList.remove('bg-dark-800', 'text-dark-200');
                uploadTab.classList.add('bg-dark-800', 'text-dark-200');
                uploadTab.classList.remove('bg-dark-700', 'text-accent-blue', 'border-b-2', 'border-accent-blue');
                
                // Show/hide content
                cameraContent.classList.remove('hidden');
                uploadContent.classList.add('hidden');
                
                // Initialize camera if needed
                if (!video.srcObject) {
                    initCamera();
                }
            });
            
            uploadTab.addEventListener('click', function() {
                // Update tab styles
                uploadTab.classList.add('bg-dark-700', 'text-accent-blue', 'border-b-2', 'border-accent-blue');
                uploadTab.classList.remove('bg-dark-800', 'text-dark-200');
                cameraTab.classList.add('bg-dark-800', 'text-dark-200');
                cameraTab.classList.remove('bg-dark-700', 'text-accent-blue', 'border-b-2', 'border-accent-blue');
                
                // Show/hide content
                uploadContent.classList.remove('hidden');
                cameraContent.classList.add('hidden');
            });
            
            // Captured image data
            let capturedImage = null;
            
            // Initialize camera
            async function initCamera() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    video.srcObject = stream;
                } catch (err) {
                    showError('Camera access denied or not available. Please use the upload option.');
                    uploadTab.click();
                }
            }
            
            // Capture image from camera
            captureButton.addEventListener('click', function() {
                const context = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                capturedImage = canvas.toDataURL('image/jpeg');
                
                // Show captured image in video element
                video.pause();
                video.srcObject.getTracks().forEach(track => track.stop());
                video.src = capturedImage;
                
                // Enable process button
                processButton.disabled = false;
                processButton.classList.remove('opacity-50');
            });
            
            // Process captured image
            processButton.addEventListener('click', function() {
                if (!capturedImage) {
                    showError('No image captured. Please capture an image first.');
                    return;
                }
                
                processImage(capturedImage, 'camera');
            });
            
            // Handle drag and drop
            dropArea.addEventListener('click', function() {
                imageUpload.click();
            });
            
            dropArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropArea.classList.add('bg-dark-600');
            });
            
            dropArea.addEventListener('dragleave', function() {
                dropArea.classList.remove('bg-dark-600');
            });
            
            dropArea.addEventListener('drop', function(e) {
                e.preventDefault();
                dropArea.classList.remove('bg-dark-600');
                
                if (e.dataTransfer.files.length) {
                    imageUpload.files = e.dataTransfer.files;
                    const fileName = e.dataTransfer.files[0].name;
                    dropArea.querySelector('p').textContent = `Selected: ${fileName}`;
                }
            });
            
            imageUpload.addEventListener('change', function() {
                if (this.files.length) {
                    const fileName = this.files[0].name;
                    dropArea.querySelector('p').textContent = `Selected: ${fileName}`;
                }
            });
            
            // Handle file upload
            uploadForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!imageUpload.files.length) {
                    showError('Please select a file to upload.');
                    return;
                }
                
                const file = imageUpload.files[0];
                const formData = new FormData();
                formData.append('file', file);
                
                showLoading('Processing uploaded image...');
                
                fetch('/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showResult(data.text);
                        showSuccess('Image processed successfully!');
                    } else {
                        showError(data.message || 'Error processing image.');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showError('Error uploading image: ' + error.message);
                });
            });
            
            // Process image from camera
            function processImage(imageData, source) {
                showLoading('Processing image...');
                
                const formData = new FormData();
                formData.append('image', imageData);
                
                fetch('/camera', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showResult(data.text);
                        showSuccess('Image processed successfully!');
                    } else {
                        showError(data.message || 'Error processing image.');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showError('Error processing image: ' + error.message);
                });
            }
            
            // Train model
            trainButton.addEventListener('click', function() {
                showLoading('Training model... This may take a few minutes.');
                
                fetch('/train', {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showSuccess('Model trained successfully!');
                        const modelStatus = document.querySelector('.bg-dark-800.border-l-4.border-accent-blue');
                        modelStatus.innerHTML = '<i class="fas fa-info-circle text-accent-blue text-lg mr-3 mt-0.5"></i><div><strong>Model Status:</strong> Loaded and ready to use</div>';
                    } else {
                        showError(data.message || 'Error training model.');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showError('Error training model: ' + error.message);
                });
            });
            
            // Helper functions
            function showLoading(message) {
                loadingText.textContent = message || 'Processing...';
                loading.classList.remove('hidden');
                loading.classList.add('flex');
                hideAlerts();
            }
            
            function hideLoading() {
                loading.classList.add('hidden');
                loading.classList.remove('flex');
            }
            
            function showSuccess(message) {
                successAlert.textContent = message;
                successAlert.classList.remove('hidden');
                errorAlert.classList.add('hidden');
            }
            
            function showError(message) {
                errorAlert.textContent = message;
                errorAlert.classList.remove('hidden');
                successAlert.classList.add('hidden');
            }
            
            function hideAlerts() {
                successAlert.classList.add('hidden');
                errorAlert.classList.add('hidden');
            }
            
            function showResult(text) {
                resultText.innerHTML = `<p class="text-white">${text}</p>`;
            }
            
            // Initialize camera on page load
            initCamera();
        });
    </script>
</body>
</html> 
